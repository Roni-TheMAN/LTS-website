import React, { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import { Edit2, MoreHorizontal, ChevronDown, Plus, Image as ImageIcon, X, Upload, Trash2, Save } from 'lucide-react';

const BRANDS = [
  { id: 1, name: 'Sony' },
  { id: 2, name: 'LTS Basics' },
  { id: 3, name: 'LTS' },
  { id: 4, name: 'Anker' },
  { id: 5, name: 'Logitech' },
];

const CATEGORIES = [
  { id: 1, name: 'Audio' },
  { id: 2, name: 'Accessories' },
  { id: 3, name: 'Services' },
];

const ProductDetail: React.FC = () => {
  const navigate = useNavigate();
  const [isAddVariantOpen, setIsAddVariantOpen] = useState(false);
  const [isAddMediaOpen, setIsAddMediaOpen] = useState(false);
  const [isManageMediaOpen, setIsManageMediaOpen] = useState(false);
  const [isEditingInfo, setIsEditingInfo] = useState(false);
  const [productStatus, setProductStatus] = useState<'active' | 'inactive' | 'archived'>('active');

  const [variants, setVariants] = useState([
    { id: 1, name: "Blue Switch / White", sku: "KB-W-BLU", price: "$120.00", stock: "45 in stock", stockColor: "green", img: "https://picsum.photos/seed/kb1/100/100", active: true },
    { id: 2, name: "Red Switch / Black", sku: "KB-B-RED", price: "$120.00", stock: "12 low stock", stockColor: "amber", img: "https://picsum.photos/seed/kb2/100/100", active: true },
    { id: 3, name: "Brown Switch / Grey", sku: "KB-G-BRN", price: "$120.00", stock: "Archived", stockColor: "slate", img: "https://picsum.photos/seed/kb3/100/100", active: false, archived: true }
  ]);

  const toggleVariantActive = (e: React.MouseEvent, id: number) => {
    e.stopPropagation();
    setVariants(variants.map(v => v.id === id ? { ...v, active: !v.active } : v));
  };

  return (
    <div className="max-w-6xl mx-auto pb-10 relative">

      {/* Add Media Modal */}
      {isAddMediaOpen && (
        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/20 backdrop-blur-sm p-4">
          <div className="bg-white rounded-xl shadow-xl w-full max-w-lg overflow-hidden border border-slate-200 animate-in fade-in zoom-in duration-200">
            <div className="px-6 py-4 border-b border-slate-100 flex items-center justify-between">
              <h3 className="font-semibold text-slate-900">Upload Media</h3>
              <button onClick={() => setIsAddMediaOpen(false)} className="text-slate-400 hover:text-slate-900 transition-colors">
                <X className="w-5 h-5" />
              </button>
            </div>
            <div className="p-6">
              <div className="border-2 border-dashed border-slate-300 rounded-xl p-8 flex flex-col items-center justify-center bg-slate-50 hover:bg-slate-100 transition-colors cursor-pointer">
                <div className="w-12 h-12 bg-white rounded-full flex items-center justify-center shadow-sm mb-3">
                  <Upload className="w-5 h-5 text-indigo-600" />
                </div>
                <p className="text-sm font-medium text-slate-900">Click to upload or drag and drop</p>
                <p className="text-xs text-slate-500 mt-1">SVG, PNG, JPG or GIF (max. 3MB)</p>
              </div>
              <div className="mt-4">
                 <label className="block text-xs font-medium text-slate-500 uppercase mb-1.5">Or add from URL</label>
                 <div className="flex gap-2">
                   <input type="text" placeholder="https://" className="flex-1 px-3 py-2 bg-white border border-slate-200 rounded-lg text-sm focus:outline-none focus:border-slate-400 focus:ring-1 focus:ring-slate-400 transition-all placeholder:text-slate-300" />
                   <button className="px-3 py-2 bg-slate-100 text-slate-700 text-sm font-medium rounded-lg hover:bg-slate-200">Add</button>
                 </div>
              </div>
            </div>
            <div className="px-6 py-4 bg-slate-50 border-t border-slate-100 flex justify-end gap-3">
              <button onClick={() => setIsAddMediaOpen(false)} className="px-4 py-2 text-sm font-medium text-slate-600 hover:text-slate-900 transition-colors">Cancel</button>
              <button className="px-4 py-2 text-sm font-medium text-white bg-slate-900 hover:bg-slate-800 rounded-lg shadow-sm transition-colors">Done</button>
            </div>
          </div>
        </div>
      )}

      {/* Manage Media Modal */}
      {isManageMediaOpen && (
        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/20 backdrop-blur-sm p-4">
          <div className="bg-white rounded-xl shadow-xl w-full max-w-2xl overflow-hidden border border-slate-200 animate-in fade-in zoom-in duration-200">
            <div className="px-6 py-4 border-b border-slate-100 flex items-center justify-between">
              <h3 className="font-semibold text-slate-900">Manage Media</h3>
              <button onClick={() => setIsManageMediaOpen(false)} className="text-slate-400 hover:text-slate-900 transition-colors">
                <X className="w-5 h-5" />
              </button>
            </div>
            <div className="p-6">
              <div className="grid grid-cols-4 gap-4">
                {[1, 2, 3].map((i) => (
                  <div key={i} className="group relative aspect-square rounded-lg bg-slate-100 overflow-hidden border border-slate-200">
                    <img src={`https://picsum.photos/seed/kb${i}/200/200`} className="w-full h-full object-cover" alt="" />
                    <div className="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors flex items-center justify-center opacity-0 group-hover:opacity-100">
                       <button className="p-2 bg-white text-red-600 rounded-full shadow-sm hover:bg-red-50 transition-colors">
                          <Trash2 className="w-4 h-4" />
                       </button>
                    </div>
                  </div>
                ))}
              </div>
            </div>
            <div className="px-6 py-4 bg-slate-50 border-t border-slate-100 flex justify-end gap-3">
              <button onClick={() => setIsManageMediaOpen(false)} className="px-4 py-2 text-sm font-medium text-white bg-slate-900 hover:bg-slate-800 rounded-lg shadow-sm transition-colors">Close</button>
            </div>
          </div>
        </div>
      )}

      {/* Add Variant Modal */}
      {isAddVariantOpen && (
        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/20 backdrop-blur-sm p-4">
          <div className="bg-white rounded-xl shadow-xl w-full max-w-lg overflow-hidden border border-slate-200 animate-in fade-in zoom-in duration-200">
            <div className="px-6 py-4 border-b border-slate-100 flex items-center justify-between">
              <h3 className="font-semibold text-slate-900">Add New Variant</h3>
              <button onClick={() => setIsAddVariantOpen(false)} className="text-slate-400 hover:text-slate-900 transition-colors">
                <X className="w-5 h-5" />
              </button>
            </div>
            <div className="p-6 space-y-4">
              <div>
                <label className="block text-xs font-medium text-slate-500 uppercase mb-1.5">Variant Name</label>
                <input type="text" placeholder="e.g. Midnight Blue / Large" className="w-full px-3 py-2 bg-slate-50 border border-slate-200 rounded-lg text-sm focus:outline-none focus:border-slate-400 focus:ring-1 focus:ring-slate-400 transition-all placeholder:text-slate-400" />
              </div>

              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-xs font-medium text-slate-500 uppercase mb-1.5">SKU</label>
                  <input type="text" placeholder="PROD-VAR-001" className="w-full px-3 py-2 bg-slate-50 border border-slate-200 rounded-lg text-sm focus:outline-none focus:border-slate-400 focus:ring-1 focus:ring-slate-400 transition-all placeholder:text-slate-400" />
                </div>
                <div>
                   <label className="block text-xs font-medium text-slate-500 uppercase mb-1.5">Starting Price</label>
                   <div className="relative">
                     <span className="absolute left-3 top-2 text-slate-400 text-sm">$</span>
                     <input type="text" placeholder="0.00" className="w-full pl-7 pr-3 py-2 bg-slate-50 border border-slate-200 rounded-lg text-sm focus:outline-none focus:border-slate-400 focus:ring-1 focus:ring-slate-400 transition-all placeholder:text-slate-400" />
                   </div>
                </div>
              </div>

              <div>
                <label className="block text-xs font-medium text-slate-500 uppercase mb-1.5">Description</label>
                <textarea rows={3} placeholder="Specific details for this variant..." className="w-full px-3 py-2 bg-slate-50 border border-slate-200 rounded-lg text-sm focus:outline-none focus:border-slate-400 focus:ring-1 focus:ring-slate-400 transition-all resize-none placeholder:text-slate-400" />
              </div>
            </div>
            <div className="px-6 py-4 bg-slate-50 border-t border-slate-100 flex justify-end gap-3">
              <button onClick={() => setIsAddVariantOpen(false)} className="px-4 py-2 text-sm font-medium text-slate-600 hover:text-slate-900 transition-colors">Cancel</button>
              <button className="px-4 py-2 text-sm font-medium text-white bg-slate-900 hover:bg-slate-800 rounded-lg shadow-sm transition-colors">Create Variant</button>
            </div>
          </div>
        </div>
      )}

      <div className="mb-8">
        <div className="flex items-center gap-2 text-sm text-slate-500 mb-2">
          <span className="hover:text-slate-900 cursor-pointer" onClick={() => navigate('/products')}>Catalog</span>
          <span className="text-slate-300">/</span>
          <span className="text-slate-900 font-medium">Product #201</span>
        </div>
        <div className="flex items-center justify-between">
          <h1 className="text-3xl font-bold text-slate-900">Wireless Mechanical Keyboard</h1>
        </div>
      </div>

      <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <div className="lg:col-span-2 space-y-6">

          {/* Basic Info */}
          <div className="bg-white rounded-xl border border-slate-200 p-6 shadow-sm transition-all">
            <div className="flex items-center justify-between mb-4">
              <h2 className="text-lg font-semibold text-slate-900">Basic Information</h2>
              <button onClick={() => setIsEditingInfo(!isEditingInfo)} className="text-slate-400 hover:text-slate-600 transition-colors">
                {isEditingInfo ? (
                   <div className="flex items-center gap-1 text-indigo-600 font-medium text-sm">
                      <Save className="w-4 h-4" /> Save
                   </div>
                ) : (
                   <Edit2 className="w-4 h-4" />
                )}
              </button>
            </div>
            <div className="space-y-4">
              <div>
                <label className="block text-xs font-medium text-slate-500 uppercase mb-1">Product Title</label>
                <input
                  type="text"
                  defaultValue="Wireless Mechanical Keyboard"
                  disabled={!isEditingInfo}
                  className={`w-full py-2 rounded-lg text-sm text-slate-900 transition-all ${isEditingInfo ? 'bg-slate-50 border border-slate-200 px-3' : 'bg-transparent border-transparent px-0 font-medium'}`}
                />
              </div>

              <div className="grid grid-cols-2 gap-4">
                <div>
                   <label className="block text-xs font-medium text-slate-500 uppercase mb-1">Brand</label>
                   <select
                      disabled={!isEditingInfo}
                      defaultValue="Logitech"
                      className={`w-full py-2 rounded-lg text-sm text-slate-900 transition-all ${isEditingInfo ? 'bg-slate-50 border border-slate-200 px-3' : 'bg-transparent border-transparent px-0 font-medium appearance-none disabled:opacity-100'}`}
                   >
                      {BRANDS.map(b => (
                        <option key={b.id} value={b.name}>{b.name}</option>
                      ))}
                   </select>
                </div>
                <div>
                   <label className="block text-xs font-medium text-slate-500 uppercase mb-1">Category</label>
                   <select
                      disabled={!isEditingInfo}
                      defaultValue="Audio"
                      className={`w-full py-2 rounded-lg text-sm text-slate-900 transition-all ${isEditingInfo ? 'bg-slate-50 border border-slate-200 px-3' : 'bg-transparent border-transparent px-0 font-medium appearance-none disabled:opacity-100'}`}
                   >
                      {CATEGORIES.map(c => (
                        <option key={c.id} value={c.name}>{c.name}</option>
                      ))}
                   </select>
                </div>
              </div>

              <div>
                <label className="block text-xs font-medium text-slate-500 uppercase mb-1">Description</label>
                <textarea
                  rows={4}
                  defaultValue="High-performance wireless mechanical keyboard featuring hot-swappable switches, RGB backlighting, and a durable aluminum frame. Perfect for coding and gaming enthusiasts."
                  disabled={!isEditingInfo}
                  className={`w-full py-2 rounded-lg text-sm text-slate-900 resize-none transition-all ${isEditingInfo ? 'bg-slate-50 border border-slate-200 px-3' : 'bg-transparent border-transparent px-0'}`}
                />
              </div>
            </div>
          </div>

          {/* Variants */}
          <div className="bg-white rounded-xl border border-slate-200 p-6 shadow-sm">
             <div className="flex items-center justify-between mb-6">
               <div>
                 <h2 className="text-lg font-semibold text-slate-900">Variants</h2>
                 <p className="text-sm text-slate-500 mt-1">Manage SKUs, prices and inventory.</p>
               </div>
               <button
                  onClick={() => setIsAddVariantOpen(true)}
                  className="bg-slate-100 hover:bg-slate-200 text-slate-900 px-3 py-1.5 rounded-lg text-sm font-medium flex items-center gap-1.5 transition-colors"
                >
                  <Plus className="w-4 h-4" /> Add variant
               </button>
             </div>
             <table className="w-full text-left text-sm">
               <thead>
                 <tr className="border-b border-slate-200">
                   <th className="pb-3 font-semibold text-slate-500 uppercase text-xs pl-1">Variant</th>
                   <th className="pb-3 font-semibold text-slate-500 uppercase text-xs">SKU</th>
                   <th className="pb-3 font-semibold text-slate-500 uppercase text-xs">Price</th>
                   <th className="pb-3 font-semibold text-slate-500 uppercase text-xs">Inventory</th>
                   <th className="pb-3 font-semibold text-slate-500 uppercase text-xs text-right pr-1">Active</th>
                 </tr>
               </thead>
               <tbody>
                 {variants.map((variant, i) => (
                   <tr key={i} className="border-b border-dashed border-slate-200 last:border-0 hover:bg-slate-50 transition-colors cursor-pointer group" onClick={!variant.archived ? () => navigate('variant') : undefined}>
                     <td className="py-4 pl-1 flex items-center gap-3">
                       <div className={`w-8 h-8 rounded bg-slate-100 flex items-center justify-center overflow-hidden ${variant.archived ? 'opacity-50' : ''}`}>
                         <img src={variant.img} className="w-full h-full object-cover mix-blend-multiply" alt="" />
                       </div>
                       <span className={`font-medium ${variant.archived ? 'text-slate-400 line-through' : 'text-slate-900'}`}>{variant.name}</span>
                     </td>
                     <td className={`py-4 ${variant.archived ? 'text-slate-400' : 'text-slate-500'}`}>{variant.sku}</td>
                     <td className={`py-4 font-medium ${variant.archived ? 'text-slate-400' : 'text-slate-900'}`}>{variant.price}</td>
                     <td className="py-4">
                       <span className={`px-2 py-1 rounded text-xs font-medium bg-${variant.stockColor}-50 text-${variant.stockColor}-700 border border-${variant.stockColor}-100`}>
                         {variant.stock}
                       </span>
                     </td>
                     <td className="py-4 text-right pr-1">
                        <button
                          onClick={(e) => toggleVariantActive(e, variant.id)}
                          className={`relative inline-flex h-5 w-9 items-center rounded-full transition-colors focus:outline-none ${variant.active ? 'bg-emerald-500' : 'bg-slate-200'}`}
                        >
                          <span className={`${variant.active ? 'translate-x-4' : 'translate-x-0.5'} inline-block h-4 w-4 transform rounded-full bg-white transition shadow-sm`} />
                        </button>
                     </td>
                   </tr>
                 ))}
               </tbody>
             </table>
          </div>
        </div>

        <div className="space-y-6">
          {/* Status */}
          <div className="bg-white rounded-xl border border-slate-200 p-6 shadow-sm">
            <h2 className="text-sm font-semibold text-slate-900 mb-4">Status</h2>
            <div className="space-y-4">
                <div className="flex bg-slate-100 p-1 rounded-lg border border-slate-200">
                  {(['active', 'inactive', 'archived'] as const).map(status => (
                      <button
                        key={status}
                        onClick={() => setProductStatus(status)}
                        className={`flex-1 capitalize py-1.5 text-xs font-medium rounded-md transition-all ${productStatus === status ? 'bg-white text-slate-900 shadow-sm' : 'text-slate-500 hover:text-slate-900'}`}
                      >
                        {status}
                      </button>
                  ))}
                </div>
               <div className="flex items-center justify-between text-sm">
                 <span className="text-slate-500">Sales Channels</span>
                 <span className="font-medium text-slate-900">{productStatus === 'active' ? '3 of 3' : '0 of 3'}</span>
               </div>
               <div className="h-1.5 w-full bg-slate-100 rounded-full overflow-hidden">
                 <div className={`h-full w-full transition-all duration-300 ${productStatus === 'active' ? 'bg-green-500' : 'bg-slate-300 w-0'}`} />
               </div>
            </div>
          </div>

          {/* Media */}
          <div className="bg-white rounded-xl border border-slate-200 p-6 shadow-sm">
             <div className="flex items-center justify-between mb-4">
               <h2 className="text-sm font-semibold text-slate-900">Media</h2>
               <button onClick={() => setIsManageMediaOpen(true)} className="text-xs text-indigo-600 hover:underline font-medium">Manage</button>
             </div>
             <div className="grid grid-cols-2 gap-2">
               {[1,2,3].map(i => (
                 <div key={i} className="aspect-square rounded-lg bg-slate-100 overflow-hidden relative group">
                   <img src={`https://picsum.photos/seed/kb${i}/200/200`} className="w-full h-full object-cover" alt="" />
                   <div className="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors" />
                 </div>
               ))}
               <div
                onClick={() => setIsAddMediaOpen(true)}
                className="aspect-square rounded-lg border-2 border-dashed border-slate-300 flex flex-col items-center justify-center text-slate-400 hover:border-slate-400 hover:text-slate-500 transition-colors cursor-pointer"
               >
                  <ImageIcon className="w-5 h-5 mb-1" />
                  <span className="text-xs">Add</span>
               </div>
             </div>
          </div>

          {/* Org */}
          <div className="bg-white rounded-xl border border-slate-200 p-6 shadow-sm">
            <h2 className="text-sm font-semibold text-slate-900 mb-4">Organization</h2>
            <div className="space-y-4">
              <div>
                <label className="block text-xs font-medium text-slate-500 uppercase mb-1">Vendor</label>
                <input type="text" defaultValue="Logitech" className="w-full px-3 py-2 bg-slate-50 border border-slate-200 rounded-lg text-sm text-slate-900" />
              </div>
              <div>
                <label className="block text-xs font-medium text-slate-500 uppercase mb-1">Product Type</label>
                <input type="text" defaultValue="Peripherals" className="w-full px-3 py-2 bg-slate-50 border border-slate-200 rounded-lg text-sm text-slate-900" />
              </div>
              <div>
                <label className="block text-xs font-medium text-slate-500 uppercase mb-2">Tags</label>
                <div className="flex flex-wrap gap-2">
                  {['wireless', 'gaming'].map(tag => (
                    <span key={tag} className="inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-slate-100 text-slate-700 border border-slate-200">
                      {tag}
                      <button className="ml-1 text-slate-400 hover:text-slate-600">Ã—</button>
                    </span>
                  ))}
                  <button className="inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-white text-slate-500 border border-dashed border-slate-300 hover:border-slate-400">
                    + Add
                  </button>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  );
};

export default ProductDetail;